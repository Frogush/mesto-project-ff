(()=>{"use strict";const e=document.querySelector("#card-template").content;function t(t,o,n,r,c){const i=e.querySelector(".card").cloneNode(!0),a=i.querySelector(".card__image"),s=i.querySelector(".card__title"),u=i.querySelector(".card__delete-button"),l=i.querySelector(".card__like-button"),d=i.querySelector(".card__like-counter");return a.src=t.link,a.alt=t.name,s.textContent=t.name,d.textContent=t.likes.length,t.owner._id!==c&&(u.style.display="none"),u.addEventListener("click",(()=>o(t._id,i))),l.addEventListener("click",(()=>{const e=l.classList.contains("card__like-button_is-active");n(t._id,e,l,d)})),a.addEventListener("click",(()=>r(t.link,t.name))),i}function o(e){e.remove()}function n(e){if("Escape"===e.key){const e=document.querySelector(".popup_is-opened");e&&c(e)}}function r(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n)}function c(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}function i(e,t,o){e.some((e=>!e.validity.valid))?(t.classList.add(o.inactiveButtonClass),t.disabled=!0):(t.classList.remove(o.inactiveButtonClass),t.disabled=!1)}function a(e,t,o){const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""}function s(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector));o.forEach((o=>{a(e,o,t)})),i(o,e.querySelector(t.submitButtonSelector),t)}const u="https://mesto.nomoreparties.co/v1/wff-cohort-35",l={config:{authorization:"ebdf6473-eefa-4fdb-a47c-68f2c2046815","Content-Type":"application/json"}},d=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),p=e=>fetch(u+"/cards/"+e+"/likes",{method:"PUT",headers:l.config}).then(d),m=e=>fetch(u+"/cards/"+e+"/likes",{method:"DELETE",headers:l.config}).then(d);document.querySelector(".logo").src="/mesto-project-ff/images/logo.0863e5bc26221680f1e2.svg";const _=document.querySelector(".profile__edit-button"),f=document.querySelector(".profile__add-button"),y=document.querySelector(".profile__image-button"),v=document.forms["edit-profile"],h=document.forms["new-place"],S=document.forms["new-avatar"],g=document.querySelectorAll(".popup"),q=document.querySelector(".places__list"),b=document.querySelector(".popup_type_new-card"),E=b.querySelector(".popup__form"),L=E.querySelector(".popup__input_type_card-name"),C=E.querySelector(".popup__input_type_card-url"),k=document.querySelector(".popup_type_edit"),x=k.querySelector(".popup__form"),T=x.querySelector(".popup__input_type_name"),A=x.querySelector(".popup__input_type_description"),w=document.querySelector(".profile__title"),B=document.querySelector(".profile__description"),D=document.querySelector(".popup_type_avatar"),P=document.querySelector(".popup__input_type_avatar-url"),$=document.querySelector(".profile__image"),j=document.querySelector(".popup_type_image"),N=j.querySelector(".popup__image"),O=j.querySelector(".popup__caption");let J=null;const M={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};var G;function H(e,t){t.textContent=e?"Сохранение...":"Сохранение"}function I(e,t,o,n){(t?m:p)(e).then((e=>{var t,r;!function(e){e.classList.toggle("card__like-button_is-active")}(o),t=n,r=e.likes,t.textContent=r.length})).catch((e=>{console.log("Ошибка обновления лайка:",e)}))}function V(e,t){(e=>fetch(u+"/cards/"+e,{method:"DELETE",headers:l.config}).then(d))(e).then((()=>{o(t)})).catch((e=>{console.log("Ошибка при удалении карточки:",e)}))}function z(e,t){N.src=e,N.alt=t,O.textContent=t,r(j)}G=M,Array.from(document.querySelectorAll(G.formSelector)).forEach((e=>{e.addEventListener("submit",(e=>e.preventDefault())),function(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach((r=>{r.addEventListener("input",(()=>{!function(e,t,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?a(e,t,o):function(e,t,o,n){const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.classList.add(n.errorClass),r.textContent=o}(e,t,t.validationMessage,o)}(e,r,t),i(o,n,t)}))}))}(e,G)})),_.addEventListener("click",(()=>{T.value=w.textContent,A.value=B.textContent,s(v,M),r(k)})),f.addEventListener("click",(()=>{s(h,M),r(b)})),y.addEventListener("click",(()=>{s(S,M),r(D)})),x.addEventListener("submit",(function(e){e.preventDefault();const t=T.value,o=A.value;H(!0,e.submitter),((e,t)=>fetch(u+"/users/me",{method:"PATCH",headers:l.config,body:JSON.stringify({name:e,about:t})}).then(d))(t,o).then((e=>{w.textContent=e.name,B.textContent=e.about,setTimeout((()=>{c(k)}),100)})).catch((e=>{console.log("Ошибка обновления профиля:",e)})).finally((()=>{H(!1,e.submitter)}))})),E.addEventListener("submit",(function(e){e.preventDefault();const n={name:L.value,link:C.value};var r,i;H(!0,e.submitter),(r=n.name,i=n.link,fetch(u+"/cards",{method:"POST",headers:l.config,body:JSON.stringify({name:r,link:i})}).then(d)).then((e=>{q.prepend(t(e,o,I,z,J)),setTimeout((()=>{c(b)}),100),E.reset()})).catch((e=>{console.log("Ошибка добавления карточки:",e)})).finally((()=>{H(!1,e.submitter)}))})),S.addEventListener("submit",(function(e){e.preventDefault();const t=P.value;H(!0,e.submitter),(e=>fetch(u+"/users/me/avatar",{method:"PATCH",headers:l.config,body:JSON.stringify({avatar:e})}).then(d))(t).then((e=>{$.style.backgroundImage=`url(${e.avatar})`,setTimeout((()=>{c(D)}),100),S.reset()})).catch((e=>{console.log("Ошибка при обновлении аватара:",e)})).finally((()=>{H(!1,e.submitter)}))})),g.forEach((e=>{e.querySelector(".popup__close").addEventListener("click",(()=>c(e))),e.addEventListener("mousedown",(t=>{t.target.classList.contains("popup")&&c(e)}))})),Promise.all([fetch(u+"/cards",{methon:"GET",headers:l.config}).then(d),fetch(u+"/users/me",{method:"GET",headers:l.config}).then(d)]).then((([e,o])=>{!function(e){w.textContent=e.name,B.textContent=e.about,$.style.backgroundImage=`url(${e.avatar})`}(o),J=o._id,e.forEach((e=>{q.append(t(e,V,I,z,J))}))})).catch((e=>{console.log("Ошибка при загрузке данных:",e)}))})();